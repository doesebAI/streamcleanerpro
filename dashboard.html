
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stream Cleaner Pro ‚Äì Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f8fafc; color: #1e293b; }
    .dashboard { display: flex; flex-direction: row; min-height: 100vh; }
    .sidebar { background: #1e293b; color: white; padding: 2rem 1.5rem; width: 240px; }
    .sidebar h1 { font-size: 1.5rem; margin-bottom: 2rem; }
    .sidebar nav a { display: block; color: #cbd5e1; text-decoration: none; margin: 1rem 0; font-weight: 500; transition: color 0.2s; }
    .sidebar nav a:hover { color: #3b82f6; }
    .dashboard-content { flex: 1; padding: 2rem 3rem; display: flex; flex-direction: column; gap: 2rem; background: linear-gradient(to bottom right, #f1f5f9, #e2e8f0); }
    .dashboard-card { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
    h2 i { margin-right: 0.5rem; color: #3b82f6; }
    .stream-dropdown, .ad-code-input, input, textarea { width: 100%; margin-top: 1rem; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 1rem; }
    .ad-code-input { height: 180px; resize: vertical; }
    button { background: #3b82f6; color: white; border: none; padding: 0.9rem 1.8rem; border-radius: 0.5rem; font-size: 1rem; margin-top: 1rem; cursor: pointer; }
    button:hover { background: #2563eb; }
    .file-status { font-size: 0.9rem; color: #64748b; margin-top: 0.5rem; }
    .stream-thumbnails { display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; }
    .stream-thumb { width: 180px; height: 100px; background-color: #cbd5e1; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: #1e293b; }
    .gamified { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .badge { background-color: #facc15; padding: 0.5rem 1rem; border-radius: 999px; font-weight: bold; color: #1e293b; }
    @media screen and (max-width: 768px) {
      .dashboard { flex-direction: column; }
      .sidebar { width: 100%; display: flex; flex-wrap: wrap; justify-content: space-around; }
      .sidebar h1 { display: none; }
      .dashboard-content { padding: 1.5rem; }
      .stream-thumbnails { flex-direction: column; align-items: center; }
      button { width: 100%; }
    }
  </style>
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script src="dashboard.js"></script>
<script>
  netlifyIdentity.on('init', user => {
    if (!user) {
      window.location.href = "/login.html";npm -v

    }
  });
  netlifyIdentity.init();
</script>
</head>
<body>

<section class="dashboard">
  <aside class="sidebar">
    <h1><i class="fas fa-bolt"></i> Dashboard</h1>
    <nav>
      <a href="#step1"><i class="fas fa-satellite-dish"></i> Operations</a>
      <a href="#tutorials"><i class="fas fa-video"></i> Tutorials</a>
      <a href="#profile"><i class="fas fa-user-circle"></i> Profile</a>
      <a href="#support"><i class="fas fa-comment-dots"></i> Support</a>
      <a href="#" onclick="netlifyIdentity.logout(); location.reload();"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </aside>

  <main class="dashboard-content">

    <div class="gamified">
      <p>üéÆ XP: <strong>1200</strong> | Cleaned Streams: <strong>18</strong></p>
      <span class="badge">‚≠ê PRO MEMBER</span>
    </div>

    <!-- Step 1 -->
    <section id="step1" class="dashboard-card animate__animated animate__fadeIn">
  <h2><i class="fas fa-futbol"></i> Step 1: Select Football Match</h2>
  <p>Select a live football match to clean and export.</p>
  <select id="streamSelect" class="stream-dropdown">
    <option>Loading streams...</option>
  </select>
  <div id="matchList" class="stream-thumbnails"></div>
</section>

<section id="step2" class="dashboard-card animate__animated animate__fadeIn">
  <h2><i class="fas fa-broom"></i> Step 2: Clean Iframe</h2>
  <p>We‚Äôll remove overlays, popups, and malicious scripts from the selected stream iframe.</p>
  <button onclick="simulateCleaning()">üßπ Start Cleaning</button>
  <p id="cleanStatus" class="file-status">Waiting to clean iframe...</p>
</section>

<section id="step3" class="dashboard-card animate__animated animate__fadeIn">
  <h2><i class="fas fa-bullhorn"></i> Step 3: Insert Your Ad Code</h2>
  <p>Paste your banner/overlay/JavaScript ad snippet below:</p>
  <textarea id="adCode" class="ad-code-input" placeholder="Paste ad script here..."></textarea>
</section>

<section id="step4" class="dashboard-card animate__animated animate__fadeIn">
  <h2><i class="fas fa-download"></i> Step 4: Export Clean Embed</h2>
  <p>Click below to generate your cleaned, ready-to-host HTML file.</p>
  <button id="cleanDownloadBtn">üîΩ Download Clean File</button>
  <p class="file-status" id="fileStatus">Waiting for export...</p>
</section>



    <!-- Tutorials -->
    <section id="tutorials" class="dashboard-card animate__animated animate__fadeIn">
      <h2><i class="fas fa-video"></i> Tutorials</h2>
      <p>Click a question to watch a quick tutorial.</p>
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        <button onclick="showVideo('host')">üìÅ How to host your cleaned file</button>
        <button onclick="showVideo('traffic')">üö¶ How to get traffic to your stream</button>
        <button onclick="showVideo('ads')">üí∏ How to generate and insert ad JS code</button>
        <button onclick="showVideo('legal')">üìú Legal tips: embedding streams safely</button>
        <button onclick="showVideo('optimize')">‚öôÔ∏è How to optimize embeds for speed</button>
      </div>
      <div id="videoContainer" style="margin-top: 2rem; display:none;">
        <h3>Tutorial Video:</h3>
        <iframe id="tutorialVideo" width="100%" height="315" style="border-radius: 1rem; border: none;" allowfullscreen></iframe>
      </div>
    </section>

    <!-- Profile -->
<section id="profile">
  <h2>Profile</h2>
  <div class="profile-card">
    <p><strong>Email:</strong> <span id="profileEmail"></span></p>
    <button id="resetPasswordBtn" class="btn">Reset Password</button>
  </div>
</section>

    <!-- Support -->
<section id="support">
  <h2>Support</h2>
  <form id="supportForm" action="https://formspree.io/f/xdkdywpq" method="POST">
    <label>Subject:</label>
    <input type="text" name="subject" required>

    <label>Message:</label>
    <textarea name="message" required></textarea>

    <input type="hidden" name="email" id="supportEmail">

    <button type="submit" class="btn">Send Message</button>
  </form>
</section>


  </main>
</section>

<script>
// -----------------------------
// Load Streams (Scraper + Fallback)
// -----------------------------
let selectedStream = null;

async function loadStreams() {
  try {
    const res = await fetch("/.netlify/functions/fetch-streams");
    let streams = await res.json();

    // Fallback if scraper returns empty
    if (!streams || streams.length === 0) {
      streams = [
        {
          match: "Manchester City vs Arsenal",
          iframe: "https://vibestreams.org/assets/s2.php",
          thumbnail: "https://via.placeholder.com/180x100?text=Man+City+vs+Arsenal"
        },
        {
          match: "PSG vs Marseille",
          iframe: "https://vibestreams.org/assets/s5.php",
          thumbnail: "https://via.placeholder.com/180x100?text=PSG+vs+Marseille"
        },
        {
          match: "Bayern Munich vs Dortmund",
          iframe: "https://vibestreams.org/assets/s6.php",
          thumbnail: "https://via.placeholder.com/180x100?text=Bayern+vs+Dortmund"
        }
      ];
    }

    const select = document.getElementById("streamSelect");
    const list = document.getElementById("matchList");
    select.innerHTML = "";
    list.innerHTML = "";

    streams.forEach((stream, idx) => {
      // Dropdown
      const option = document.createElement("option");
      option.value = idx;
      option.textContent = stream.match;
      select.appendChild(option);

      // Thumbnail
      const thumb = document.createElement("div");
      thumb.className = "stream-thumb";
      thumb.innerHTML = `<img src="${stream.thumbnail}" alt="${stream.match}" style="width:100%;height:100%;border-radius:0.5rem;">`;
      thumb.onclick = () => { selectedStream = stream; select.value = idx; };
      list.appendChild(thumb);
    });

    select.onchange = () => {
      selectedStream = streams[select.value];
    };

    if (streams.length > 0) {
      selectedStream = streams[0];
      select.value = 0;
    }

  } catch (err) {
    console.error("Error loading streams:", err);
  }
}

// -----------------------------
// Cleaning Simulation
// -----------------------------
function simulateCleaning() {
  const status = document.getElementById("cleanStatus");
  status.textContent = "‚è≥ Cleaning in progress...";
  setTimeout(() => {
    status.textContent = "‚úÖ Cleaning complete. Ads removed.";
  }, 2000);
}

// -----------------------------
// Export Cleaned HTML
// -----------------------------
document.getElementById("cleanDownloadBtn").addEventListener("click", async () => {
  if (!selectedStream) {
    alert("Please select a match first!");
    return;
  }

  const adCode = document.getElementById("adCode").value;

  const res = await fetch("/.netlify/functions/clean-stream", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      iframeUrl: selectedStream.iframe,
      adScript: adCode,
      matchName: selectedStream.match
    })
  });

  const blob = await res.blob();
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = selectedStream.match.replace(/\s+/g, '_') + ".html";
  document.body.appendChild(a);
  a.click();
  a.remove();

  document.getElementById("fileStatus").textContent = "‚úÖ File downloaded.";
});

// -----------------------------
// Tutorials Video Loader
// -----------------------------
function showVideo(topic) {
  const videoMap = {
    host: "https://www.youtube.com/embed/v1HostingDemo",
    traffic: "https://www.youtube.com/embed/v2TrafficTips",
    ads: "https://www.youtube.com/embed/v3AdCodeSetup",
    legal: "https://www.youtube.com/embed/v4LegalTips",
    optimize: "https://www.youtube.com/embed/v5EmbedSpeed"
  };
  const iframe = document.getElementById("tutorialVideo");
  const container = document.getElementById("videoContainer");
  iframe.src = videoMap[topic] || "";
  container.style.display = "block";
}

// -----------------------------
// Netlify Identity Integration
// -----------------------------
const user = netlifyIdentity.currentUser();
if (user) {
  document.getElementById("profileEmail").textContent = user.email;
  document.getElementById("supportEmail").value = user.email;
}

document.getElementById("resetPasswordBtn").addEventListener("click", () => {
  if (user) {
    netlifyIdentity.open('reset');
  }
});

// -----------------------------
// Init
// -----------------------------
document.addEventListener("DOMContentLoaded", loadStreams);
</script>


</body>
</html>
