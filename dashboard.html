<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stream Cleaner Pro â€“ Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f8fafc; color: #1e293b; }
    .dashboard { display: flex; flex-direction: row; min-height: 100vh; }
    .sidebar { background: #1e293b; color: white; padding: 2rem 1.5rem; width: 240px; }
    .sidebar h1 { font-size: 1.5rem; margin-bottom: 2rem; }
    .sidebar nav a { display: block; color: #cbd5e1; text-decoration: none; margin: 1rem 0; font-weight: 500; transition: color 0.2s; }
    .sidebar nav a:hover { color: #3b82f6; }
    .dashboard-content { flex: 1; padding: 2rem 3rem; display: flex; flex-direction: column; gap: 2rem; background: linear-gradient(to bottom right, #f1f5f9, #e2e8f0); }
    .dashboard-card { background: white; padding: 1.25rem; border-radius: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
    h2 i { margin-right: 0.5rem; color: #3b82f6; }
    .stream-dropdown, input, textarea, select { width: 100%; margin-top: .6rem; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 1rem; }
    button { background: #3b82f6; color: white; border: none; padding: 0.9rem 1.2rem; border-radius: 0.5rem; font-size: 1rem; margin-top: .5rem; cursor: pointer; }
    button:hover { background: #2563eb; }
    .file-status { font-size: 0.9rem; color: #64748b; margin-top: 0.5rem; }
    .toggle-row { display: flex; align-items: center; justify-content: space-between; margin: 0.75rem 0; }
    .toggle-row label { font-weight: 500; }
    .muted { color: #64748b; font-size: 0.85rem; margin-top: 0.25rem; }
    .balance { font-size: 1.8rem; font-weight: 700; margin-bottom: 0.5rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.75rem; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 0.95rem; }
    th { background: #f1f5f9; }
    .status-paid { color: green; font-weight: 600; }
    .status-pending { color: orange; font-weight: 600; }
    .status-rejected { color: red; font-weight: 600; }
    @media screen and (max-width: 900px) {
      .dashboard { flex-direction: column; }
      .sidebar { width: 100%; display: flex; flex-wrap: wrap; justify-content: space-around; }
      .sidebar h1 { display: none; }
      .dashboard-content { padding: 1.25rem; }
      button { width: 100%; }
    }
    .dashboard-card canvas {
      min-height: 300px !important;
      width: 100% !important;
    }
    .stats-table table { width: 100%; border-collapse: collapse; }
    .stats-table th { background: #f8fafc; padding: 12px; text-align: left; }
    .stats-table td { padding: 12px; border-bottom: 1px solid #e5e7eb; }
    .bar-wrapper { background: #f1f5f9; border-radius: 4px; height: 24px; position: relative; }
    .bar { position: absolute; left: 0; top: 0; height: 100%; border-radius: 4px; padding: 0 8px; line-height: 24px; color: white; }
    .bar.traffic { background: #2563eb; }
    .bar.revenue { background: #16a34a; }
    .card { 
      border: 1px solid #e5e7eb; 
      border-radius: 0.5rem; 
      padding: 1rem; 
      margin: 0.5rem 0; 
      cursor: pointer; 
      transition: all 0.2s;
    }
    .card:hover { 
      background-color: #f1f5f9; 
      border-color: #3b82f6;
    }
    .card.selected { 
      background-color: #dbeafe; 
      border-color: #3b82f6;
    }
    .preview iframe { 
      width: 100%; 
      height: 400px; 
      border: none; 
      border-radius: 0.5rem; 
      margin-top: 1rem;
    }
    
    /* Quick Stats Styles */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid #e2e8f0;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #64748b;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 0.5rem;
    }
    
    .stat-trend {
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .stat-trend.positive {
      color: #16a34a;
    }
    
    .stat-trend.negative {
      color: #dc2626;
    }
    
    .stat-trend.neutral {
      color: #64748b;
    }
    
    .stat-trend i {
      margin-right: 0.25rem;
    }
  </style>
</head>
<body>
<section class="dashboard">
  <aside class="sidebar">
    <h1><i class="fas fa-bolt"></i> Dashboard</h1>
    <nav>
      <a href="#tool"><i class="fas fa-tv"></i> Stream Tool</a>
      <a href="#stats"><i class="fas fa-chart-simple"></i> Quick Stats</a>
      <a href="#withdrawals"><i class="fas fa-wallet"></i> Withdrawals</a>
      <a href="#profile"><i class="fas fa-user-circle"></i> Profile</a>
      <a href="#support"><i class="fas fa-comment-dots"></i> Support</a>
      <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </aside>

  <main class="dashboard-content">

    <!-- Stream Tool -->
    <div id="tool" class="dashboard-card">
      <h2><i class="fas fa-tv"></i> Stream Tool</h2>

      <!-- Step 1 -->
      <h3>Step 1: Select Stream</h3>
      <select id="streamSelect" class="stream-dropdown"><option>Loadingâ€¦</option></select>
      <div id="thumbList" style="margin-top:10px"></div>
      <div id="matchPreview" class="preview" style="display:none;"></div>

      <!-- Step 2 -->
      <h3 style="margin-top:16px">Step 2: Enable Monetization</h3>
      <div class="toggle-row">
        <label>Enable Monetization</label>
        <input type="checkbox" id="enableMonetization"/>
      </div>

      <div id="monetizationOptions" style="display:none; margin-top:1rem">
        <div class="toggle-row">
          <label>CPAGrip Locker</label>
          <input type="checkbox" id="enableCpagrip" />
        </div>
        <p class="muted">Visitors must complete an offer to unlock the stream after 45 minutes.</p>
      </div>

      <!-- Step 3 -->
      <h3 style="margin-top:16px">Step 3: Download Export</h3>
      <label style="display:block; margin-top:6px">
        <input id="includeLinks" type="checkbox"> Include optional links block in export
      </label>
      <button id="downloadBtn">ðŸ“¥ Download HTML</button>
      <span id="fileStatus" class="file-status">Waiting for exportâ€¦</span>
    </div>

    <!-- Quick Stats Section -->
    <section id="stats" class="dashboard-card">
      <h2><i class="fas fa-chart-simple"></i> Quick Stats</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Page Views</div>
          <div class="stat-value">1,234</div>
          <div class="stat-trend positive"><i class="fas fa-arrow-up"></i> â†‘ 12% this week</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">Estimated Revenue</div>
          <div class="stat-value">$45.60</div>
          <div class="stat-trend positive"><i class="fas fa-arrow-up"></i> â†‘ 8% this week</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">Conversions</div>
          <div class="stat-value">31</div>
          <div class="stat-trend neutral"><i class="fas fa-minus"></i> ~ Steady</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">Active Streams</div>
          <div class="stat-value">7</div>
          <div class="stat-trend positive"><i class="fas fa-arrow-up"></i> â†‘ 3 this week</div>
        </div>
      </div>
    </section>

    <!-- Withdrawals -->
   <section id="withdrawals" class="dashboard-card">
      <h2><i class="fas fa-wallet"></i> Withdrawals</h2>
      <div class="balance">$0.00</div>
      <p class="muted">Available Balance (Minimum $50 to withdraw)</p>
      <h3>Earnings Breakdown</h3>
      <table>
        <tr><th>Source</th><th>Amount</th></tr>
        <tr><td>CPAGrip</td><td>$0.00</td></tr>
        <tr><td>Display Ads</td><td>$0.00</td></tr>
        <tr><td>Popunders</td><td>$0.00</td></tr>
        <tr><td>Preroll Ads</td><td>$0.00</td></tr>
      </table>
      <h3 style="margin-top:1.5rem">Request Withdrawal</h3>
      <input type="number" placeholder="Amount (USD)"/>
      <select><option>PayPal</option><option>Bank Transfer</option><option>Crypto</option></select>
      <button>Request Withdrawal</button>
      <h3 style="margin-top:1.5rem">Withdrawal History</h3>
      <table><tr><th>Date</th><th>Amount</th><th>Method</th><th>Status</th></tr>
        <tr><td colspan="4" class="muted">No withdrawals yet</td></tr>
      </table>
    </section>

    <!-- Profile -->
    <section id="profile" class="dashboard-card">
      <h2><i class="fas fa-user-circle"></i> Profile</h2>
      <p><strong>Email:</strong> <span id="profileEmail">â€”</span></p>
      <input type="email" id="updateEmail" placeholder="New email">
      <input type="password" id="updatePassword" placeholder="New password">
      <button id="saveProfileBtn">Update Profile</button>
    </section>

    <!-- Support -->
    <section id="support" class="dashboard-card">
      <h2><i class="fas fa-comment-dots"></i> Support</h2>
      <form id="supportForm" action="https://formspree.io/f/xdkdywpq" method="POST">
        <label>Subject:</label>
        <input type="text" name="subject" required>
        <label>Message:</label>
        <textarea name="message" required></textarea>
        <input type="hidden" name="email" id="supportEmail">
        <button type="submit">Send Message</button>
      </form>
    </section>

  </main>
</section>

<script>
/* ---------- Mirror Links ---------- */
const MIRROR_LINK_PLACEHOLDERS = [
  { label: "StreamEast", url: "https://www.streameast100.com/" },
  { label: "TOTALSPORTEK", url: "https://totalsportek.army/" },
  { label: "FOOTYBITE", url: "https://www.footybite.to/" },
  { label: "NFLBITE", url: "https://www.nflbite.to/" },
  { label: "NBABITE", url: "https://reddit.nbabite.to/" },
  { label: "SPORTSURGE", url: "https://sportsurge100.com/" },
  { label: "HESGOAL", url: "https://hesgoalfree.com/" },
  { label: "SOCCER STREAMS", url: "https://soccer-1000.com/" },
  { label: "F1 STREAMS", url: "https://www.f1streamsfree.com/" },
  { label: "Hoofoot", url: "https://hufoot.com/" }
];

/* ---------- Fixtures ---------- */
const DASH_FIXTURES = [
  {
    FixtureKey: "2025-09-13-brentford-vs-chelsea",
    dateISO: "2025-09-13T19:00:00Z", 
    homeName: "Brentford",
    homeLogo: "https://totalsportek.army/assets2/images/premier/Brentford.png",
    awayName: "Chelsea", 
    awayLogo: "https://totalsportek.army/assets2/images/premier/Chelsea.png",
    league: "Premier League",
    iframeHtml: null,
    status: "Upcoming"
  }
];

const PLACEHOLDER_IFRAME = "https://placeholder.com/embed";
const REVEAL_BEFORE_MS = 30 * 60 * 1000;
let currentFixtures = [];

/* ---------- Helpers ---------- */
function parseISO(s){ if(!s) return null; const d=new Date(s); return isNaN(d)?null:d; }
function isToday(iso){ const d=parseISO(iso); if(!d) return false; const n=new Date(); return d.getFullYear()===n.getFullYear()&&d.getMonth()===n.getMonth()&&d.getDate()===n.getDate(); }
function shouldReveal(kickoffIso){ const d=parseISO(kickoffIso); if(!d) return false; return Date.now() >= (d.getTime() - REVEAL_BEFORE_MS); }

/* ---------- Dashboard UI ---------- */
async function loadLocalDashboard(){
  currentFixtures = DASH_FIXTURES.filter(f=>isToday(f.dateISO))
    .map(f=>({...f, kickoffMs: parseISO(f.dateISO)?.getTime()||null}))
    .sort((a,b)=>(a.kickoffMs||0)-(b.kickoffMs||0));
  renderDashboardUI(currentFixtures);
}

function renderDashboardUI(fixtures){
  const sel = document.getElementById('streamSelect');
  const wrap = document.getElementById('thumbList');
  if(!sel || !wrap) return;

  sel.innerHTML = `<option value="">-- Choose a match --</option>`;
  wrap.innerHTML = "";

  if(!fixtures.length){
    sel.innerHTML = `<option value="">No fixtures</option>`;
    wrap.innerHTML = '<p>No fixtures found</p>';
    return;
  }

  fixtures.forEach((fx,i)=>{
    const opt = document.createElement('option'); opt.value = i;
    opt.textContent = `[${fx.league}] ${fx.homeName} vs ${fx.awayName}`;
    sel.appendChild(opt);

    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="title">${fx.homeName} vs ${fx.awayName}</div>
      <div style="font-size:12px">League: ${fx.league}</div>
    `;
    card.addEventListener('click', ()=> { 
      sel.value = i; 
      showDashboardPreview(fx); 
      document.querySelectorAll('#thumbList .card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
    });
    wrap.appendChild(card);
  });

  showDashboardPreview(fixtures[0]);
}

function showDashboardPreview(fx){
  const preview = document.getElementById('matchPreview');
  if(!preview) return;
  preview.style.display = 'block';
  const reveal = shouldReveal(fx.dateISO) && fx.iframeHtml;
  const embedHtml = reveal ? fx.iframeHtml : `<iframe src="${PLACEHOLDER_IFRAME}" allowfullscreen></iframe>`;
  preview.innerHTML = `
    <div><b>${fx.homeName} vs ${fx.awayName}</b></div>
    <div>${fx.league} â€¢ ${new Date(fx.dateISO).toLocaleString()}</div>
    <div>${embedHtml}</div>
  `;
}

/* ---------- UI refs ---------- */
const enableMonetization = document.getElementById("enableMonetization");
const monetizationOptionsEl = document.getElementById("monetizationOptions");

/* ---------- Wire main enable toggle ---------- */
enableMonetization?.addEventListener("change", () => {
  monetizationOptionsEl.style.display = enableMonetization.checked ? "block" : "none";
});

/* ---------- Quick Stats Functionality ---------- */
function updateQuickStats() {
  // Simulate dynamic data updates
  const pageViews = Math.floor(1234 + Math.random() * 100);
  const revenue = (45.60 + Math.random() * 5).toFixed(2);
  const conversions = Math.floor(31 + Math.random() * 5);
  const activeStreams = Math.floor(7 + Math.random() * 3);
  
  // Update the DOM
  document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = pageViews.toLocaleString();
  document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = `$${revenue}`;
  document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = conversions;
  document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = activeStreams;
}

/* ---------- Export ---------- */
document.getElementById('downloadBtn')?.addEventListener('click', ()=> {
  const sel = document.getElementById('streamSelect');
  const idx = parseInt(sel?.value,10);
  if(isNaN(idx)) return alert('Select a match first.');
  const fx = currentFixtures[idx];
  if(!fx) return alert('Match not found.');

  const reveal = shouldReveal(fx.dateISO) && fx.iframeHtml;
  const embedHtml = reveal ? fx.iframeHtml : `<iframe src="${PLACEHOLDER_IFRAME}" allowfullscreen></iframe>`;
  const include = document.getElementById('includeLinks')?.checked || false;
  const linksBlock = include ? `<div><ul>${MIRROR_LINK_PLACEHOLDERS.map(l=>`<li><a href="${l.url}">${l.label}</a></li>`).join('')}</ul></div>` : '';
  
  // Check if CPAGrip is enabled
  const cpagripEnabled = document.getElementById('enableMonetization')?.checked && 
                         document.getElementById('enableCpagrip')?.checked;
  const cpagripScript = cpagripEnabled ? '<script>/* CPAGrip locker code goes here */<\/script>' : '';
  
  const html = `<!doctype html><html><head><meta charset="utf-8"></head><body><h1>${fx.homeName} vs ${fx.awayName}</h1>${embedHtml}${cpagripScript}${linksBlock}</body></html>`;

  const blob = new Blob([html], {type:'text/html'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`${fx.homeName.replace(/\s+/g,'_')}_vs_${fx.awayName.replace(/\s+/g,'_')}.html`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);

  const status=document.getElementById('fileStatus');
  if(status) status.textContent='âœ… File downloaded.';
});

/* ---------- Initialize Dashboard ---------- */
document.addEventListener('DOMContentLoaded', async () => {
  // Initialize dashboard
  await loadLocalDashboard();
  setInterval(loadLocalDashboard, 60*1000);
  
  // Initialize quick stats and update periodically
  updateQuickStats();
  setInterval(updateQuickStats, 10000); // Update every 10 seconds
});
</script>
</body>
</html>
